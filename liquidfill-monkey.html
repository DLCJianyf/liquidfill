<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>Document</title>
        <script src="./lib/path-data-polyfill.js"></script>
        <style>
            html,
            body {
                width: 100%;
                height: 100%;
                overflow: hidden;
                display: block;
            }
            div {
                width: 700px;
                height: 700px;
                border: 1px solid #000000;
                margin: 0 auto;
            }
        </style>
    </head>
    <body>
        <div>
            <canvas id="canvas" width="700px" height="700px"></canvas>
        </div>
    </body>
    <script>
        var canvas = document.createElement("canvas");
        canvas.width = "700";
        canvas.height = "700";
        var ctx = canvas.getContext("2d");

        var canvas1 = document.getElementById("canvas");
        var ctx1 = canvas1.getContext("2d");

        var HF = 350;
        var R = 250;
        var CP = [HF, HF];
        var R1 = 230;
        var Y = 200;
        var WAVE = 40;
        var AM = 20;
        var FRAME = 1;
        var QUECY = 20;

        // ctx.beginPath();
        // ctx.arc(CP[0], CP[1], R, 0, 2 * Math.PI);
        // ctx.lineWidth = 8;
        // ctx.strokeStyle = "#294D99";
        // ctx.stroke();
        // ctx.closePath();

        //ctx.beginPath();
        // ctx.arc(CP[0], CP[1], R1, 0, 2 * Math.PI);
        //ctx.save();
        ctx.translate(20, 150);
        //ctx.scale(2, 2);
        let pathStr =
            "path://M442.3712722207685,29.899090013949856 C442.3712722207685,29.899090013949856 442.3712722207685,18.784843727279387 449.2338241666461,11.590050639935974 C453.1663291035053,7.525369112243258 465.7251539110017,5.459519182873895 465.7251539110017,5.459519182873895 C465.7251539110017,5.459519182873895 479.2117007173398,2.4712126183786842 495.55495367433457,3.105977596676566 C508.2166151201399,3.5956459132679948 524.5883673780751,7.7269507720194435 524.5883673780751,7.7269507720194435 C524.5883673780751,7.7269507720194435 542.6784481159182,8.00015909600889 548.8869112110597,13.584668905071966 C556.4667287796701,20.451217003639798 544.4996132341628,28.46050006313381 544.4996132341628,28.46050006313381 C544.4996132341628,28.46050006313381 546.087203662255,33.134139903343254 552.1930294148711,37.06043976910101 C557.2234549729164,40.2882479920758 567.0112708283439,42.95897456743116 567.0112708283439,42.95897456743116 C567.0112708283439,42.95897456743116 568.8663162343964,43.77017287302682 570.2550094434092,45.31317448694175 C571.484066708033,46.721217772128874 572.2009337391473,48.92544936343616 572.2009337391473,48.92544936343616 C572.2009337391473,48.92544936343616 578.2330200417983,51.58142927262463 578.6485518071327,54.87283249342497 C579.1093237214799,58.39162403978568 573.9423805330885,62.572172230182964 573.9423805330885,62.572172230182964 C573.9423805330885,62.572172230182964 571.5867040505441,69.07624200780874 567.3072251072431,73.77187018059868 C564.5473767205709,76.82034840970154 559.1980778653914,78.77033167636633 559.1980778653914,78.77033167636633 C559.1980778653914,78.77033167636633 546.9407876195121,84.96801313113315 531.9688891359858,86.3992297488647 C520.6447018758176,87.47823804530606 505.52472660493214,83.88834650137902 505.52472660493214,83.88834650137902 C505.52472660493214,83.88834650137902 513.2924801230353,98.52125266774658 512.416176443354,113.42736715810359 C513.6573907524352,136.82387469150436 484.01213890982416,156.57387401625158 471.33034858712506,182.92392811533531 C466.85177312892233,190.86263784390925 469.61182081140544,200.0899691950959 469.61182081140544,200.0899691950959 C469.61182081140544,200.0899691950959 468.32576494491735,223.2481600699774 463.59129366577025,243.869266031605 C459.73292677049506,260.81489711889947 452.3239057116573,275.959854934423 452.3239057116573,275.959854934423 C452.3239057116573,275.959854934423 456.85808470104257,285.11345295479293 455.7553809804058,291.0152794196772 C459.5984020982619,292.5197027015709 476.040306481557,299.1030358098218 473.94809906076193,304.3668056298501 C470.80879145051017,304.69886895183356 464.99672772287136,302.66317068810014 464.99672772287136,302.66317068810014 C464.99672772287136,302.66317068810014 462.3337371002078,304.53112562423325 459.04435974449717,304.81526228118497 C456.626104377383,305.0389639402047 454.36688706720213,305.35720226265545 453.30822772073196,303.723877318501 C447.6406534558616,304.534285624127 437.59096290516567,301.5421607264282 437.59096290516567,301.5421607264282 C437.59096290516567,301.5421607264282 429.8576875623123,297.83613918646995 426.20997633894166,293.891669321332 C424.23535344646865,291.7768393936373 421.1201606293119,293.73603932665407 425.16287614950016,288.1903711829273 C429.205790965486,282.6447030392009 424.7475436799897,281.54857807668014 424.7475436799897,281.54857807668014 C424.7475436799897,281.54857807668014 415.71087373510477,284.3949479793599 409.6903465894694,284.2233863185593 C406.7314016879085,284.1262163218817 404.5006836786667,280.93619643094667 404.5006836786667,280.93619643094667 C404.5006836786667,280.93619643094667 405.58744373445677,274.2786033252398 404.870377407532,268.44366352473486 C403.8121166526809,260.1427388085482 400.8073337146508,251.81205742670628 400.8073337146508,251.81205742670628 C400.8073337146508,251.81205742670628 393.5691091655974,246.69351593504726 387.92405532734153,232.02308476996294 C384.02024898720475,221.8958117828802 383.6049165176925,207.69582560171403 380.8733681361627,197.23951762588547 C378.1418197546061,186.6038796561849 372.6556046774738,179.6155398951183 373.1058139138556,179.77841155621465 C359.95049674491986,190.8072061791396 343.4579712257034,193.42513442296826 343.4579712257034,193.42513442296826 C343.4579712257034,193.42513442296826 346.1496604451155,210.18419384996898 343.8848628522299,223.84921838276236 C341.71094414904445,237.0252329322706 334.5920977906041,247.11945758714748 334.5920977906041,247.11945758714748 C334.5920977906041,247.11945758714748 327.06668797832884,259.27387050492143 324.81006151369104,267.50237855691853 C323.2039365751961,273.3594383566639 325.13072847311486,274.7955266408993 326.59694775248215,276.25136492445546 C335.5367599333569,283.1384530223207 375.3959220746951,270.63012011664875 384.8624730832557,279.6358564754088 C385.8356345269342,279.99464812980676 387.89555602640195,281.68287807208435 390.27993110569577,282.6391730393901 C392.8121836765412,283.6556396713035 397.8312493733809,288.676747832965 396.31759769106435,289.2444944802206 C395.06004112550306,289.7375861300264 392.35699204487236,289.1772128158518 392.35699204487236,289.1772128158518 C392.35699204487236,289.1772128158518 393.0852189372057,292.2478110442021 391.4123299021321,293.36868933921454 C389.62544366334043,294.511687633467 385.45996192375816,293.7344593267074 385.45996192375816,293.7344593267074 C385.45996192375816,293.7344593267074 382.745552981935,292.3149610419079 377.6525485393314,291.91179772235864 C372.80427935226527,291.53062273539 365.5259963452577,292.1655193803507 365.5259963452577,292.1655193803507 C365.5259963452577,292.1655193803507 345.7506702320713,287.4176195426819 328.2983360884821,295.27390594074126 C319.094855550062,298.4447024989961 312.0633007567026,298.46432083165956 302.7420363941375,299.22614413894695 C297.5523734833476,299.65208579105 295.2020779876711,296.9924192153177 295.2020779876711,296.9924192153177 C295.2020779876711,296.9924192153177 293.4891304946556,298.49420916397236 290.05785452171784,299.79415411952255 C286.1484678989016,301.2435407366375 281.9772065808051,303.3802273302495 281.9772065808051,303.3802273302495 C281.9772065808051,303.3802273302495 283.93469003357103,304.9720772758224 287.0817701804356,306.0998022372696 C289.06775293412903,306.78762888041666 292.81770290837835,307.22094386560184 292.81770290837835,307.22094386560184 C292.81770290837835,307.22094386560184 307.30312031796996,308.7037738149019 320.9917530763585,305.82396058003354 C323.2623302477449,305.73429558309704 339.85589874299245,311.6140020487369 342.01267800645826,312.86918033915674 C343.65726703641604,313.8107286402962 340.40954250513755,316.71582187430283 337.6536800346777,317.4717201817961 C323.579011290956,322.96761832722 313.61422075562166,314.84813027149295 291.07087512754237,320.4830684121689 C270.2673819269244,322.14470168868854 261.66776769493845,320.27358675266464 254.73087841166654,316.9565085327397 C250.12734448014808,314.7596502745202 249.75167187697076,310.0674454349444 249.75167187697076,310.0674454349444 C249.75167187697076,310.0674454349444 243.0880171501739,304.187080635998 242.55888677275541,298.717910822985 C242.33109166111723,296.30485590549057 251.3564017447704,287.71979453234945 255.12927073726752,283.34161468204 C258.23629242617756,279.7702881374761 261.8840036495475,275.3994816202481 261.8840036495475,275.3994816202481 C261.8840036495475,275.3994816202481 264.797509106272,271.33506342587924 266.77213199874615,266.149766936498 C268.245924518931,262.38357373193253 268.51915907540587,257.9385072172443 270.334544615123,254.32965567396383 C272.50826402251124,249.90618249186966 276.3664316219897,246.41003761140615 276.3664316219897,246.41003761140615 C276.3664316219897,246.41003761140615 265.9299079026952,240.94824113147507 257.9347578645869,234.1115813652256 C248.0389236797528,225.62013498887842 240.22573071681276,215.43650867039233 240.22573071681276,215.43650867039233 C240.22573071681276,215.43650867039233 214.47033450756632,202.86932076673378 195.2362958162704,187.75082795030536 C183.06430417735925,178.20552160999466 174.010494792767,163.4456887813037 174.010494792767,163.4456887813037 C174.010494792767,163.4456887813037 169.49983270904633,166.5447270086789 163.10164000210952,170.46536520796576 C117.640073326014,198.32313425550424 114.00133041413021,254.9849606515587 99.70345036241184,316.38428521897373 C90.40291276415978,356.323128853456 68.20614255089933,381.81708631514493 53.80323360692444,390.08799103236305 C40.69216010797795,397.62669744127834 24.240888821564138,398.015377427992 24.240888821564138,398.015377427992 C24.240888821564138,398.015377427992 13.958022172348663,398.1272940908318 12.785963509577787,396.73017913860025 C11.659144995845846,395.43734418280064 19.69415419611293,392.6055892796199 19.69415419611293,392.6055892796199 C19.69415419611293,392.6055892796199 34.43985193448064,387.6191094501121 43.691163467481935,379.72477138668467 C82.43108033589151,346.66761751691257 86.33488667601657,250.81481412747007 103.68936657654568,210.17313385035047 C112.45957802249441,189.63431955257468 124.28320058429513,134.6842914313261 206.7880788922537,104.6931274567287 C266.7418390355177,82.8993982018569 396.32198219889676,68.19262703801937 428.78208807193204,41.00569963421188 C435.30364488567886,35.54350815429703 442.3712722207685,29.899090013949856 442.3712722207685,29.899090013949856 z";

        let identifier = "path://";
        pathStr = pathStr.slice(pathStr.lastIndexOf(identifier) + identifier.length);
        let path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", pathStr);

        let normalizedPathData = path.getPathData({ normalize: true });
        normalizedPathData.forEach(function(item) {
            switch (item.type) {
                case "M":
                    ctx.beginPath();
                    ctx.moveTo(...item.values);
                    break;
                case "C":
                    ctx.bezierCurveTo(...item.values);
                    break;
                case "L":
                    ctx.lineTo(...item.values);
                    break;
                case "Z":
                    ctx.closePath;
                    break;
            }
        });
        ctx.strokeStyle = "#FF0000";
        ctx.lineWidth = 4;
        ctx.stroke();
        ctx.clip();
        //ctx.restore();

        ctx.save();

        function getY(PX) {
            return Math.sin(PX / WAVE - FRAME / QUECY) * AM + HF - 200;
        }

        function animate() {
            FRAME++;
            ctx.clearRect(0, 0, 700, 700);

            ctx.restore();

            // ctx.beginPath();
            // ctx.arc(CP[0], CP[1], R1, 0, 2 * Math.PI);
            // ctx.fillStyle = "#E3F7FF";
            // ctx.fill();
            // ctx.closePath();

            ctx.beginPath();
            ctx.font = "80px Verdana";
            ctx.fillStyle = "#294D99";
            ctx.fillText("30%", CP[0] - 100, CP[1] - 200);
            ctx.closePath();

            ctx.save();
            ctx.beginPath();
            // var angle = Math.acos(Math.abs(HF - Y) / R);
            // var VX = R1 * Math.sin(angle);
            // var X = [Math.floor(HF - VX), Math.ceil(HF + VX)];

            var pX = 0;
            var PY = 0;
            var X = [HF - R1 - 200, HF + R1];
            for (PX = X[0]; PX <= X[1] + 1; PX++) {
                PY = getY(PX);
                PX === X[0] ? ctx.moveTo(PX, PY) : ctx.lineTo(PX, PY);
            }
            ctx.lineTo(X[1], HF + R1);
            ctx.lineTo(X[0], HF + R1);

            ctx.shadowBlur = 20;
            ctx.shadowColor = "rgba(0, 0, 0, 0.5)";
            ctx.fillStyle = "#294D99";
            ctx.fill();

            ctx.closePath();
            ctx.clip();

            ctx.beginPath();
            ctx.font = "80px Verdana";
            ctx.fillStyle = "#FFF";
            ctx.fillText("30%", CP[0] - 100, CP[1] - 200);
            ctx.closePath();
            ctx.restore();

            ctx1.putImageData(ctx.getImageData(0, 0, 700, 700), 0, 0);

            window.requestAnimationFrame(animate);
        }

        animate();
    </script>
</html>
